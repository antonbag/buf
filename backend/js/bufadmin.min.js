var buf_editor;jQuery(function(a){"use strict";function t(){a(".btn_buf_clean").on("click",function(t){t.preventDefault();var e=a(this).children("a").attr("class"),o={templateid:templateid,action:e,tpath:tpath,layout:buf_layout},s={option:"com_ajax",plugin:"bufajax",data:o,format:"json"};return a.ajax({type:"POST",dataType:"json",data:s,beforeSend:function(a){},success:function(t){"do_clean_bs"==e?(a("div.do_clean_bs div.buf_toolbar_file_info").html(t.data),a("div.do_clean_bs div.btn_buf_clean").remove()):(a("div.do_clean_fa div.buf_toolbar_file_info").html(t.data),a("div.do_clean_fa div.btn_buf_clean").remove())},error:function(t){console.log(t),a("#compile_fa_sass > .btn").html('<i class="fa fa-exclamation-circle"></i> error :/')}}),!1})}function e(){}function o(){a("#jform_params_buf_fa_selector").on("change",function(){var t=a("#jform_params_buf_fa_selector input:checked").val();"4"==t?(a("#jform_params_buf_fa").parent().parent().show(),a("#jform_params_buf_fa_defer").parent().parent().show(),a("#jform_params_buf_fa_pro").parent().parent().hide(),a("#jform_params_buf_fa5_tech").parent().parent().hide(),a("#jform_params_buf_fa5_files").parent().parent().hide(),a("#jform_params_buf_fa4fallback").parent().parent().hide()):"5"==t?(a("#jform_params_buf_fa").parent().parent().show(),a("#jform_params_buf_fa_defer").parent().parent().show(),a("#jform_params_buf_fa_pro").parent().parent().show(),a("#jform_params_buf_fa5_tech").parent().parent().show(),a("#jform_params_buf_fa5_files").parent().parent().show(),a("#jform_params_buf_fa4fallback").parent().parent().show()):(a("#jform_params_buf_fa_pro").parent().parent().hide(),a("#jform_params_buf_fa").parent().parent().hide(),a("#jform_params_buf_fa5_tech").parent().parent().hide(),a("#jform_params_buf_fa5_files").parent().parent().hide(),a("#jform_params_buf_fa4fallback").parent().parent().hide(),a("#jform_params_buf_fa_defer").parent().parent().hide())}),a("#jform_params_buf_fa_selector").trigger("change")}function s(){a(".header-title");var t=a(".buf_template_data");t.appendTo(a("#details .row .col-md-3 .card-body")),a("#jform_params_buf_layout").parent().addClass("jform_params_buf_layout"),a("#toolbar-buf_empy_cache").appendTo("#toolbar"),a("#details >.row >.col-md-9 >div.info-labels").remove()}function i(){var t=a("#jform_title").parent().parent(),e=a("#jform_params_runless").parent().parent().addClass("pull-right");e.appendTo(t),a(".buf_minilogo_bar").prependTo(a(".form-inline-header")),a("#toolbar-buf_empy_cache").appendTo("#toolbar")}function n(){a("button.button-apply, button.button-save").click(function(t){event.preventDefault();var e=a("ul#myTabTabs li.active a").attr("href");"#attrib-layout"==e&&(a("a.buf_scss_save").trigger("click"),setTimeout(function(){},1e3))})}function _(){a("#toolbar-buf_empy_cache button").on("click",function(t){t.preventDefault();var e={templateid:templateid,action:"do_clear_cache",tpath:tpath,layout:buf_layout},o={option:"com_ajax",plugin:"bufajax",data:e,format:"json"};return a.ajax({type:"POST",dataType:"json",data:o,beforeSend:function(t){a("#toolbar-buf_empy_cache > .buf_clear_cache_status").html('<i class="fa fa-cog fa-spin buf-loading"></i>')},success:function(t){a("#toolbar-buf_empy_cache .buf_clearcache_icon").hide(),"ok"==t.data?a("#toolbar-buf_empy_cache .buf_clear_cache_status").html('<i class="fas fa-badge-check"></i>'):(console.log(t),a("#toolbar-buf_empy_cache .buf_clear_cache_status").html('<i class="fas fa-times-octagon"></i>')),setTimeout(function(){a("#toolbar-buf_empy_cache .buf_clear_cache_status").html(""),a("#toolbar-buf_empy_cache .buf_clearcache_icon").show()},1e3)},error:function(t){console.log(t),a("#compile_bs_sass > .btn").html('<i class="fa fa-exclamation-circle"></i> error :/')}}),!1})}function r(){var t="";t+="",a(t).insertAfter("#toolbar-cancel")}function l(){if(a("#compile_bs_sass, div.bs4_custom_btn a").on("click",function(t){t.preventDefault();var e={templateid:templateid,action:"doreload_bs_sass",tpath:tpath,layout:buf_layout},o={option:"com_ajax",plugin:"bufajax",data:e,format:"json"};return a.ajax({type:"POST",dataType:"json",data:o,beforeSend:function(t){a("#compile_bs_sass > .btn").html('<i class="fa fa-cog fa-spin buf-loading"></i> processing')},success:function(a){Joomla.submitform("style.apply",document.getElementById("style-form"))},error:function(t){console.log(t),a("#compile_bs_sass > .btn").html('<i class="fa fa-exclamation-circle"></i> error :/')}}),!1}),"1"==a("#reloadbs").val()){a("#system-message-container > div").remove();var e={templateid:templateid,action:"do_bs_sass",tpath:tpath,layout:buf_layout},o={option:"com_ajax",plugin:"bufajax",data:e,format:"json"};a.ajax({type:"POST",dataType:"json",data:o,beforeSend:function(t){a("#compile_bs_sass > .btn").html('<i class="fa fa-cog fa-spin buf-loading"></i> processing')},success:function(e){console.log(e),0==e.success?a("#compile_bs_sass > .btn").html('<i class="icon-warning"></i>ERROR '+e.message):(console.log(e.data[0].debug),a("#compile_bs_sass > .btn").html('<i class="icon-save"></i>compiled'),setTimeout(function(){a("#compile_bs_sass > .btn").html('<i class="icon-play"></i>Compile BS');var o=e.data[0].file_data.file_name+e.data[0].file_data.file_date+e.data[0].file_data.file_size;a("div.do_clean_bs div.buf_toolbar_file_info").html(o),a(".do_clean_bs .buf_toolbar_file_buttons .btn_buf_clean").length<=0&&(a("#compile_bs_sass").after(e.data[0].file_data.file_clean),t())},1e3))},error:function(t){a("#compile_bs_sass > .btn").html('<i class="icon-warning"></i>ERROR'),console.log(t)}})}}function f(){if(a("#compile_fa_sass").on("click",function(t){t.preventDefault();var e={templateid:templateid,action:"doreload_fa_sass",tpath:tpath,layout:buf_layout},o={option:"com_ajax",plugin:"bufajax",data:e,format:"json"};return a.ajax({type:"POST",dataType:"json",data:o,beforeSend:function(t){a("#compile_fa_sass > .btn").html('<i class="fa fa-cog fa-spin buf-loading"></i> processing')},success:function(a){Joomla.submitform("style.apply",document.getElementById("style-form"))},error:function(t){console.log(t),a("#compile_fa_sass > .btn").html('<i class="fa fa-exclamation-circle"></i> error :/')}}),!1}),"1"==a("#reloadfa").val()){a("#system-message-container > div").remove();var e={templateid:templateid,action:"do_fa_sass",tpath:tpath,layout:buf_layout},o={option:"com_ajax",plugin:"bufajax",data:e,format:"json"};a.ajax({type:"POST",dataType:"json",data:o,beforeSend:function(t){a("#compile_fa_sass > .btn").html('<i class="fa fa-cog fa-spin buf-loading"></i> processing')},success:function(e){console.log(e),a("#compile_fa_sass > .btn").html('<i class="icon-save"></i>compiled'),setTimeout(function(){a("#compile_fa_sass > .btn").html('<i class="icon-play"></i>Compile FA'),a("#compile_fa_sass > .btn").html('<i class="icon-play"></i>Compile FA');var o=e.data[0].file_data.file_name+e.data[0].file_data.file_date+e.data[0].file_data.file_size;a("div.do_clean_fa div.buf_toolbar_file_info").html(o),a(".do_clean_fa .buf_toolbar_file_buttons .btn_buf_clean").length<=0&&a("#compile_fa_sass").after(e.data[0].file_data.file_clean),t()},1e3)},error:function(t){a("#compile_fa_sass > .btn").html('<i class="icon-warning"></i>ERROR'),console.log(t)}})}}function u(){a("a.buf_scss_save").on("click",function(t){t.preventDefault();var e=buf_editor.getValue(),o=a("#jform_params_buf_layout_files").find("input:checked").val(),s={templateid:templateid,action:"dosavesccsfile",tpath:tpath,file:o,layout:buf_layout,text:e},i={option:"com_ajax",plugin:"bufajax",data:s,format:"json"};a.ajax({type:"POST",dataType:"json",data:i,success:function(t){a(".buf_tb_icon").show("fast"),a(".buf_tb_msg").html(t.data[0]).hide().show("slow"),a(".buf_scss_save").addClass("disabled"),setTimeout(function(){a(".buf_tb_msg").hide("slow",function(){a(this).html(""),a(".buf_scss_save").removeClass("disabled")}),a(".buf_tb_icon").hide("fast")},2e3)},error:function(t){a(".buf_tb_msg").html("Fatal error :( ")}})})}function c(){var t=a(".buf_scss_toolbar");t.insertBefore(a("#jform_params_scss_editor")),a(".buf_tb_icon").hide("fast"),a("#jform_params_buf_layout_files input").on("change",function(t){console.log("change!");var e=a(this);e=a("#jform_params_buf_layout_files");setTimeout(function(){var t=e.find("input:checked").val(),o={templateid:templateid,action:"doreadsccsfile",tpath:tpath,file:t,layout:buf_layout},s={option:"com_ajax",plugin:"bufajax",data:o,format:"json"};a.ajax({type:"POST",dataType:"json",data:s,success:function(e){console.log(e),buf_editor.setValue(e.data[0]),"buf_layout.js"==t?a(".buf_tb_path").html("buf/layouts/"+buf_layout+"/js/"+t):"layout.php"==t?a(".buf_tb_path").html("buf/layouts/"+buf_layout+"/"+t):a(".buf_tb_path").html("buf/layouts/"+buf_layout+"/scss/"+t+".scss")},error:function(a){console.log("ERROR in load scss: "+a.responseText)}})},150)})}function b(){a("#jform_params_buf_layout").on("change",function(){""==a(this).val()||a(this).val(),Joomla.submitform("style.apply",document.getElementById("style-form"))})}function m(){a(".buf_layout_new_name_wrapper").hide(),a(".buf_duplicate_layout_a").click(function(){a(".buf_duplicate_layout_a").hide("slow"),a(".buf_layout_new_name_wrapper").show("slow")}),a(".buf_btn_create_layout").on("click",function(t){t.preventDefault(),a(".buf_btn_create_layout .fa-cog").addClass("fa-spin");var e=a("#buf_layout_name").val(),o=p(e);if("valid"!=o)a(".buf_layout_toolbar_status").html(o).show("slow"),a(".buf_btn_create_layout .fa-cog").removeClass("fa-spin"),setTimeout(function(){a(".buf_layout_toolbar_status").hide("slow")},2e3);else{var s={templateid:templateid,action:"doduplicatelayout",tpath:tpath,name:e,layout:buf_layout},i={option:"com_ajax",plugin:"bufajax",data:s,format:"json"};a.ajax({type:"POST",dataType:"json",data:i,success:function(t){"OK"!=t.data?a(".buf_layout_toolbar_status").html(t.data).show("slow"):Joomla.submitform("style.apply",document.getElementById("style-form"))},error:function(t){a(".buf_layout_toolbar_status").html("Fatal error :( ").show("slow"),console.log(t)}})}}),a(".buf_btn_cancel_layout").click(function(){a(".buf_btn_create_layout .fa-cog").removeClass("fa-spin"),a(".buf_duplicate_layout_a").show("slow"),a(".buf_layout_new_name_wrapper").hide("slow")})}function p(a){if(a.length>=30)return"Name too long";var t=/^[\\da-zA-Z0-9\-\_]{1,30}$/.test(a.toLowerCase())?"valid":"Name not valid";return t}function d(){a(".buf_zip_layout_a").on("click",function(t){t.preventDefault();var e=a(this);e.addClass("disabled");var o={templateid:templateid,action:"do_zip_layout",tpath:tpath,layout:buf_layout},s={option:"com_ajax",plugin:"bufajax",data:o,format:"json"};console.log(s),a.ajax({type:"POST",dataType:"json",data:s,success:function(t){console.log(t.data),"ok"==t.data[0].status?a(".buf_layout_toolbar_status").html('<a download rel="nofollow" href="'+t.data[0].file_path+'">Download '+t.data[0].filename+"</a>"):(console.log(t.data),a(".buf_layout_toolbar_status").html("Error in backup. See console log.")),e.removeClass("disabled")},error:function(t){a(".buf_layout_toolbar_status").html("Fatal Error in backup. See console log."),a(this).removeClass("disabled"),console.log(t)}})})}function v(){var t="";if(t+='<a class="mt-2 btn btn-default bg-info text-light buf_favicon_btn_create" title="Create favicon" href="#"><i class="fa fa-magic"></i> Create favicons</a>',t+="","4"==jversion)a(t).insertAfter(a("#imageModal_jform_params_buf_favicon").parent());else if(a(".media-preview").length>=1){var e=a(".media-preview").parent().find(">a.btn.hasTooltip");a(t).insertAfter(e)}else a(t).insertAfter(a("#imageModal_jform_params_buf_favicon").parent().find(".btn.button-select"));a(".buf_favicon_btn_create").on("click",function(t){t.preventDefault();var e=a("#jform_params_buf_favicon").val();if(""==e)return alert("You have not selected an image"),!1;var o={templateid:templateid,action:"dofavicon",tpath:tpath,image:e,layout:buf_layout},s={option:"com_ajax",plugin:"bufajax",data:o,format:"json"};return a.ajax({type:"POST",dataType:"json",data:s,success:function(t){"true"!=t.data?(a(".buffavicons_messages").show(),a(".buf_favicon_btn_create").addClass("btn-warning").html('<span class="icon-delete"></span> NOT created'),setTimeout(function(){a(".buf_favicon_btn_create").removeClass("btn-warning").html('<i class="fa fa-magic"></i> Create favicons')},2e3),a(".buffavicons_messages").addClass("alert").html(t.data)):(a(".buf_favicon_btn_create").html('<i class="fa fa-cog fa-spin"></i> Creating'),setTimeout(function(){a(".buf_favicon_btn_create").html('<span class="icon-save"></span>created'),a(".buffavicons_messages").hide()},2e3),setTimeout(function(){a(".buf_favicon_btn_create").html('<i class="fa fa-magic"></i> Create favicon')},3e3),setTimeout(function(){var t=new Date;a(".buffavicons_thumbs_wrapper").html('<div class="buffavicons_thumbs buffavicons_thumbs_svg"><div class="buffavicons_thumbs_svg_img"><img src="../templates/buf/images/icons/svgfavicon.svg" width="64"/></div></div><div class="buffavicons_thumbs"><img src="../templates/buf/layouts/'+buf_layout+"/icons/favicon-96x96.png?"+t.getTime()+'" title="96x96"/></div><div class="buffavicons_thumbs"><img src="../templates/buf/layouts/'+buf_layout+"/icons/apple-icon-57x57.png?"+t.getTime()+'" title="57x57"/></div><div class="buffavicons_thumbs"><img src="../templates/buf/layouts/'+buf_layout+"/icons/favicon-16x16.png?"+t.getTime()+'" title="16x16"/></div>')},1e3)),console.log(t)},error:function(){console.log("error")}}),!1})}function h(){"3"==jversion&&(a("#jform_params__buf_bs_v4__buf_bs_selector").change(function(){g(a("#jform_params__buf_bs_v4__buf_bs_selector_chzn a.chzn-single span").html(),4)}),a("#jform_params__buf_bs_v5__buf_bs_selector").change(function(){g(a("#jform_params__buf_bs_v5__buf_bs_selector_chzn a.chzn-single span").html(),5)})),"4"==jversion&&(a("#jform_params__buf_bs_v4__buf_bs_selector").change(function(){y(a(this).val(),4)}),a("#jform_params__buf_bs_v5__buf_bs_selector").change(function(){y(a(this).val(),5)}))}function g(t,e){var o=a(5==e?"#jform_params__buf_bs_v5__buf_bs_files":"#jform_params__buf_bs_v4__buf_bs_files"),s=a(5==e?"#jform_params__buf_bs_v5__buf_bs_files option":"#jform_params__buf_bs_v4__buf_bs_files option");if(4==e)var i=["functions","variables","mixins","reboot","grid"],n=["functions","variables","mixins","root","reboot","images","grid","tables","forms","buttons","transitions","dropdown","button-group","input-group","nav","navbar","card","pagination","media","list-group","close","utilities"];if(5==e)i=["functions","variables","mixins","utilities","grid"],n=["functions","variables","mixins","root","reboot","utilities","grid","type","images","containers","grid","tables","forms","buttons","transitions","dropdown","button-group","nav","navbar","card","pagination","list-group","close","api"];t=t.toLowerCase(),"none"==t?s.removeAttr("selected").trigger("liszt:updated"):"minimum"==t?(s.removeAttr("selected").trigger("liszt:updated"),a.each(i,function(t,o){5==e&&a('#jform_params__buf_bs_v5__buf_bs_files option[value="'+o+'"]').attr("selected","selected"),4==e&&a('#jform_params__buf_bs_v4__buf_bs_files option[value="'+o+'"]').attr("selected","selected")}),o.trigger("liszt:updated")):"recommended"==t?(s.removeAttr("selected").trigger("liszt:updated"),a.each(n,function(t,o){5==e&&a('#jform_params__buf_bs_v5__buf_bs_files option[value="'+o+'"]').attr("selected","selected"),4==e&&a('#jform_params__buf_bs_v4__buf_bs_files option[value="'+o+'"]').attr("selected","selected")}),o.trigger("liszt:updated")):"all"==t?s.attr("selected","selected").trigger("liszt:updated"):"custom"==t&&o.removeAttr("disabled","disabled").trigger("liszt:updated")}function y(t,e){if("3"!=jversion){console.log("CHECK all FILES IN BOOTSTRAP 4 ");a(5==e?"#jform_params__buf_bs_v5__buf_bs_files":"#jform_params__buf_bs_v4__buf_bs_files");var o=a(5==e?"#jform_params__buf_bs_v5__buf_bs_files option":"#jform_params__buf_bs_v4__buf_bs_files option");if(4==e)var s=["functions","variables","mixins","reboot","grid"],i=["functions","variables","mixins","root","reboot","images","grid","tables","forms","buttons","transitions","dropdown","button-group","input-group","nav","navbar","card","pagination","media","list-group","close","utilities"],n=["functions","variables","mixins","root","grid","media","utilities","print","reboot","type","code","images","tables","alert","badge","breadcrumb","buttons","button-group","card","carousel","dropdown","forms","input-group","custom-forms","jumbotron","list-group","modal","nav","navbar","pagination","popover","progress","spinners","toasts","tooltip","transitions","close"];if(5==e)s=["functions","variables","mixins","utilities","grid"],i=["functions","variables","mixins","root","reboot","utilities","grid","type","images","containers","grid","tables","forms","buttons","transitions","dropdown","button-group","nav","navbar","card","pagination","list-group","close","api"],n=["functions","variables","mixins","utilities","root","reboot","type","images","containers","grid","tables","forms","buttons","transitions","dropdown","button-group","nav","navbar","card","accordion","breadcrumb","pagination","badge","alert","progress","list-group","close","toasts","modal","tooltip","popover","carousel","spinners","offcanvas","helpers","api"];if(t=t.toLowerCase(),"none"==t){var _=[];o.removeAttr("selected").trigger("chosen:updated")}else if("minimum"==t){_=[];o.removeAttr("selected"),a.each(s,function(t,o){5==e&&a('#jform_params__buf_bs_v5__buf_bs_files option[value="'+o+'"]').attr("selected","selected"),4==e&&a('#jform_params__buf_bs_v4__buf_bs_files option[value="'+o+'"]').attr("selected","selected");var s={value:o,label:o};_.push(s)}),console.log(_)}else if("recommended"==t){_=[];o.removeAttr("selected").trigger("chosen:updated"),a.each(i,function(t,o){5==e&&a('#jform_params__buf_bs_v5__buf_bs_files option[value="'+o+'"]').attr("selected","selected"),4==e&&a('#jform_params__buf_bs_v4__buf_bs_files option[value="'+o+'"]').attr("selected","selected");var s={value:o,label:o};_.push(s)})}else if("all"==t||"custom"==t){_=[];a.each(n,function(a,t){var e={value:t,label:t};_.push(e)})}console.log(t),4==e&&jQuery("#jform_params__buf_bs_v4__buf_bs_files").parents("joomla-field-fancy-select").each(function(a,t){this.choicesInstance.clearStore(),this.choicesInstance.setValue(_)}),5==e&&jQuery("#jform_params__buf_bs_v5__buf_bs_files").parents("joomla-field-fancy-select").each(function(a,t){this.choicesInstance.clearStore(),this.choicesInstance.setValue(_)})}}a(document).ready(function(){function p(t){"undefined"==typeof CodeMirror||0==a(".CodeMirror").length?setTimeout(function(){p(t)},1e3):t()}p(function(){a(".CodeMirror").remove(),a("#jform_params_scss_editor").attr("name","cleaned_editor"),buf_editor=CodeMirror.fromTextArea(document.getElementById("jform_params_scss_editor"),{autofocus:!1,lineWrapping:!0,styleActiveLine:!0,lineNumbers:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-markergutter"],foldGutter:!0,markerGutter:!0,mode:"scss",theme:"default",autoCloseBrackets:!0,matchBrackets:!0,scrollbarStyle:"native",keyMap:"default"}),c(),a("#jform_params_buf_layout_files input").trigger("change")}),e(),v(),r(),l(),f(),t(),u(),h(),m(),b(),o(),n(),_(),d(),a("#jform_params_buf_layout_files input").trigger("change"),"4"==jversion?(s(),a("#jform_params__buf_bs_v4__buf_bs_selector").trigger("change"),a("#jform_params__buf_bs_v5__buf_bs_selector").trigger("change")):i();var g=a("#jform_params_buf_layout").val();null!=g&&""!=g||(g="default")}),a("#jform_params__buf_bs_v4__buf_bs_selector").change(function(){y(a(this).val(),4)}),a("#jform_params__buf_bs_v5__buf_bs_selector").change(function(){y(a(this).val(),5)})});